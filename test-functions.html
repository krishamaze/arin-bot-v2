<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Edge Functions (No JWT)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
        }
        h2 {
            color: #666;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        textarea {
            width: 100%;
            min-height: 150px;
            font-family: monospace;
            font-size: 12px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            margin: 5px 0;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
            color: #555;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Edge Functions (No JWT Required)</h1>
    
    <div class="container">
        <h2>Test 1: chat-api</h2>
        <div class="test-section">
            <label>Function URL:</label>
            <input type="text" id="chatApiUrl" value="https://opaxtxfxropmjrrqlewh.supabase.co/functions/v1/chat-api" readonly>
            
            <label>Request Payload:</label>
            <textarea id="chatApiPayload">{
  "botPlatformId": "test-bot-123",
  "roomPath": "/test-room",
  "events": [
    {
      "type": "message",
      "username": "testuser",
      "platformId": "user-123",
      "text": "Hello, bot!",
      "timestamp": "2025-11-09T10:00:00.000Z"
    }
  ]
}</textarea>
            
            <button onclick="testChatApi()">Test chat-api</button>
            <div id="chatApiResult"></div>
        </div>
    </div>
    
    <div class="container">
        <h2>Test 2: chat-api-v2 (Init)</h2>
        <div class="test-section">
            <label>Function URL:</label>
            <input type="text" id="chatApiV2Url" value="https://opaxtxfxropmjrrqlewh.supabase.co/functions/v1/chat-api-v2/init" readonly>
            
            <label>Request Payload:</label>
            <textarea id="chatApiV2Payload">{
  "platformId": "test-user-" + Date.now(),
  "username": "TestUser",
  "roomPath": "/test-room-" + Date.now()
}</textarea>
            
            <button onclick="testChatApiV2()">Test chat-api-v2/init</button>
            <div id="chatApiV2Result"></div>
        </div>
    </div>
    
    <div class="container">
        <h2>Test Status</h2>
        <div id="statusResult" class="result info">
            Ready to test. Click buttons above to test functions without JWT authentication.
        </div>
    </div>

    <script>
        async function testChatApi() {
            const url = document.getElementById('chatApiUrl').value;
            const payloadText = document.getElementById('chatApiPayload').value;
            const resultDiv = document.getElementById('chatApiResult');
            const statusDiv = document.getElementById('statusResult');
            
            resultDiv.innerHTML = '<div class="result info">Testing...</div>';
            statusDiv.innerHTML = '<div class="result info">Testing chat-api...</div>';
            
            try {
                const payload = JSON.parse(payloadText);
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                        // No Authorization header - testing without JWT
                    },
                    body: JSON.stringify(payload)
                });
                
                const responseText = await response.text();
                let responseData;
                try {
                    responseData = JSON.parse(responseText);
                } catch {
                    responseData = responseText;
                }
                
                if (response.ok) {
                    resultDiv.innerHTML = `<div class="result success">
<strong>‚úÖ SUCCESS (${response.status})</strong>
${JSON.stringify(responseData, null, 2)}
</div>`;
                    statusDiv.innerHTML = '<div class="result success">‚úÖ chat-api works without JWT!</div>';
                } else {
                    resultDiv.innerHTML = `<div class="result error">
<strong>‚ùå ERROR (${response.status})</strong>
${JSON.stringify(responseData, null, 2)}
${response.status === 401 ? '\n‚ö†Ô∏è JWT Authentication Required!' : ''}
</div>`;
                    if (response.status === 401) {
                        statusDiv.innerHTML = '<div class="result error">‚ùå chat-api requires JWT authentication</div>';
                    } else {
                        statusDiv.innerHTML = `<div class="result error">‚ùå chat-api error: ${response.status}</div>`;
                    }
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">
<strong>‚ùå REQUEST ERROR</strong>
${error.message}
</div>`;
                statusDiv.innerHTML = `<div class="result error">‚ùå Request failed: ${error.message}</div>`;
            }
        }
        
        async function testChatApiV2() {
            const url = document.getElementById('chatApiV2Url').value;
            const payloadText = document.getElementById('chatApiV2Payload').value;
            const resultDiv = document.getElementById('chatApiV2Result');
            const statusDiv = document.getElementById('statusResult');
            
            resultDiv.innerHTML = '<div class="result info">Testing...</div>';
            statusDiv.innerHTML = '<div class="result info">Testing chat-api-v2...</div>';
            
            try {
                // Replace Date.now() in payload if present
                let processedPayload = payloadText.replace(/Date\.now\(\)/g, Date.now().toString());
                const payload = JSON.parse(processedPayload);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                        // No Authorization header - testing without JWT
                    },
                    body: JSON.stringify(payload)
                });
                
                const responseText = await response.text();
                let responseData;
                try {
                    responseData = JSON.parse(responseText);
                } catch {
                    responseData = responseText;
                }
                
                if (response.ok) {
                    resultDiv.innerHTML = `<div class="result success">
<strong>‚úÖ SUCCESS (${response.status})</strong>
${JSON.stringify(responseData, null, 2)}
</div>`;
                    statusDiv.innerHTML = '<div class="result success">‚úÖ chat-api-v2 works without JWT!</div>';
                } else {
                    resultDiv.innerHTML = `<div class="result error">
<strong>‚ùå ERROR (${response.status})</strong>
${JSON.stringify(responseData, null, 2)}
${response.status === 401 ? '\n‚ö†Ô∏è JWT Authentication Required!' : ''}
</div>`;
                    if (response.status === 401) {
                        statusDiv.innerHTML = '<div class="result error">‚ùå chat-api-v2 requires JWT authentication</div>';
                    } else {
                        statusDiv.innerHTML = `<div class="result error">‚ùå chat-api-v2 error: ${response.status}</div>`;
                    }
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">
<strong>‚ùå REQUEST ERROR</strong>
${error.message}
</div>`;
                statusDiv.innerHTML = `<div class="result error">‚ùå Request failed: ${error.message}</div>`;
            }
        }
        
        // Update payload with current timestamp on load
        window.onload = function() {
            const timestamp = new Date().toISOString();
            const chatApiPayload = document.getElementById('chatApiPayload');
            chatApiPayload.value = chatApiPayload.value.replace(/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z/, timestamp);
        };
    </script>
</body>
</html>



